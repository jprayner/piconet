[@jprayner/piconet-nodejs](../README.md) / [Modules](../modules.md) / driver

# Module: driver

## Table of contents

### Type Aliases

- [EventMatcher](driver.md#eventmatcher)
- [EventQueue](driver.md#eventqueue)
- [Listener](driver.md#listener)

### Functions

- [addListener](driver.md#addlistener)
- [close](driver.md#close)
- [connect](driver.md#connect)
- [eventQueueCreate](driver.md#eventqueuecreate)
- [eventQueueDestroy](driver.md#eventqueuedestroy)
- [eventQueueShift](driver.md#eventqueueshift)
- [eventQueueWait](driver.md#eventqueuewait)
- [readStatus](driver.md#readstatus)
- [removeListener](driver.md#removelistener)
- [setDebugEnabled](driver.md#setdebugenabled)
- [setEconetStation](driver.md#seteconetstation)
- [setMode](driver.md#setmode)
- [transmit](driver.md#transmit)
- [waitForEvent](driver.md#waitforevent)

## Type Aliases

### EventMatcher

Ƭ **EventMatcher**: (`event`: [`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)) => `boolean`

#### Type declaration

▸ (`event`): `boolean`

Use to filter events from the Econet driver.

##### Parameters

| Name | Type |
| :------ | :------ |
| `event` | [`EconetEvent`](../classes/types_econetEvent.EconetEvent.md) |

##### Returns

`boolean`

#### Defined in

[driver/index.ts:32](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L32)

___

### EventQueue

Ƭ **EventQueue**: `Object`

Holds an ordered set of events.

#### Type declaration

| Name | Type |
| :------ | :------ |
| `events` | [`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)[] |
| `listener` | [`Listener`](driver.md#listener) |

#### Defined in

[driver/index.ts:37](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L37)

___

### Listener

Ƭ **Listener**: (`event`: [`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)) => `void`

#### Type declaration

▸ (`event`): `void`

Used to register a listener for events from the Econet driver.

##### Parameters

| Name | Type |
| :------ | :------ |
| `event` | [`EconetEvent`](../classes/types_econetEvent.EconetEvent.md) |

##### Returns

`void`

#### Defined in

[driver/index.ts:27](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L27)

## Functions

### addListener

▸ **addListener**(`listener`): `void`

Adds a new listener for events generated by the board.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `listener` | [`Listener`](driver.md#listener) | The listener to add. |

#### Returns

`void`

#### Defined in

[driver/index.ts:277](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L277)

___

### close

▸ **close**(): `Promise`<`void`\>

Disconnects from the board and closes the serial port.

#### Returns

`Promise`<`void`\>

#### Defined in

[driver/index.ts:264](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L264)

___

### connect

▸ **connect**(`requestedDevice?`): `Promise`<`void`\>

Connect the driver to the Piconet board.

This function must be successfully called before interacting with the Econet driver. The following steps
are carried out:

1. Open a serial connection to the board. If `requestedDevice` is not specified then an attempt will be
   made to autodetect it. This step may fail if the board is not connected or another application is using
   it.
2. The driver will then send a `STATUS` command to the board. This step may fail if the Raspberry Pi Pico
   has not been flashed with [correct firmware](https://github.com/jprayner/piconet/releases|the)
   (.uf2 image).
3. The driver will then compare the firmware version returned by the board against that of the driver
   using semantic versioning. If the versions are not compatible then an error will be thrown.

After connecting, the board will be in the `STOP` operating mode. Remember to call [setMode](driver.md#setmode) to
start it doing useful work.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `requestedDevice?` | `string` | Optionally specifies the serial device for the Raspberry Pi Pico on the Piconet board. If left undefined then an attempt will be made to automatically detect it. |

#### Returns

`Promise`<`void`\>

#### Defined in

[driver/index.ts:76](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L76)

___

### eventQueueCreate

▸ **eventQueueCreate**(`matcher`): [`EventQueue`](driver.md#eventqueue)

Creates an event queue to store all events matching the specified criteria, ready for
collection at the caller's convenience.

The queue should be destroyed using [eventQueueDestroy](driver.md#eventqueuedestroy) when it is no longer needed
to avoid consuming memory unnecessarily.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `matcher` | [`EventMatcher`](driver.md#eventmatcher) | Specifies which events should be stored in the queue. |

#### Returns

[`EventQueue`](driver.md#eventqueue)

A queue object which can be passed to the other `eventQueueXXX` functions.

#### Defined in

[driver/index.ts:343](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L343)

___

### eventQueueDestroy

▸ **eventQueueDestroy**(`queue`): `void`

Removes all events from queue and removes listener, preventing new events from being added.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `queue` | [`EventQueue`](driver.md#eventqueue) | The queue to destroy. |

#### Returns

`void`

#### Defined in

[driver/index.ts:364](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L364)

___

### eventQueueShift

▸ **eventQueueShift**(`queue`): `undefined` \| [`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)

Removes an event from the queue, if one is available. Otherwise returns `undefined`.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `queue` | [`EventQueue`](driver.md#eventqueue) | Queue to shift from. |

#### Returns

`undefined` \| [`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)

#### Defined in

[driver/index.ts:398](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L398)

___

### eventQueueWait

▸ **eventQueueWait**(`queue`, `timeoutMs`): `Promise`<[`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)\>

Waits for a matching event with a timeout, removing it from the queue.

If no matching event is found within the specified timeout then an error is thrown.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `queue` | [`EventQueue`](driver.md#eventqueue) | The queue to wait on. |
| `timeoutMs` | `number` | Maximum time to wait for a matching event in milliseconds. |

#### Returns

`Promise`<[`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)\>

#### Defined in

[driver/index.ts:377](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L377)

___

### readStatus

▸ **readStatus**(): `Promise`<[`StatusEvent`](../classes/types_statusEvent.StatusEvent.md)\>

Queries the current status of the board.

#### Returns

`Promise`<[`StatusEvent`](../classes/types_statusEvent.StatusEvent.md)\>

The current status of the board.

#### Defined in

[driver/index.ts:409](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L409)

___

### removeListener

▸ **removeListener**(`listener`): `void`

Removes a listener previously registered with [addListener](driver.md#addlistener).

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `listener` | [`Listener`](driver.md#listener) | The listener to remove. |

#### Returns

`void`

#### Defined in

[driver/index.ts:288](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L288)

___

### setDebugEnabled

▸ **setDebugEnabled**(`enabled`): `void`

Enables/disables driver debug logging. When enabled, shows the raw data passing between the driver
and the board.

#### Parameters

| Name | Type |
| :------ | :------ |
| `enabled` | `boolean` |

#### Returns

`void`

#### Defined in

[driver/index.ts:175](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L175)

___

### setEconetStation

▸ **setEconetStation**(`station`): `Promise`<`void`\>

Sets the Econet station number for the board so that it knows which received frames to generate
events for and how to populate the "from address" of outbound frames.

The station number should be unique on the Econet network.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `station` | `number` | The new Econet station number (an integer in range 1-254, inclusive). |

#### Returns

`Promise`<`void`\>

#### Defined in

[driver/index.ts:156](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L156)

___

### setMode

▸ **setMode**(`mode`): `Promise`<`void`\>

Puts the board into a new operating mode.

The board can be in one of three operating modes:

* `STOP` - The board starts in this mode. No events are generated in response to network traffic,
       allowing the client to initialise configuration before proceeding.

* `LISTEN` - The normal Econet station operating mode. The board generates events for broadcast
       frames or frames targeting the configured local Econet station number. You should normally
       set the station number before entering this mode: see [setEconetStation](driver.md#seteconetstation).

* `MONITOR` - The board generates an event for every frame received, regardless of its source or
       destination (promiscuous mode). Useful for capturing traffic between other stations like
       the BBC NETMON utility. A code example is provided for how to build such a utility.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `mode` | ``"MONITOR"`` \| ``"STOP"`` \| ``"LISTEN"`` | The new operating mode. |

#### Returns

`Promise`<`void`\>

#### Defined in

[driver/index.ts:124](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L124)

___

### transmit

▸ **transmit**(`station`, `network`, `controlByte`, `port`, `data`, `extraScoutData?`): `Promise`<[`TxResultEvent`](../classes/types_txResultEvent.TxResultEvent.md)\>

Implements an Econet `TRANSMIT` operation.

This consists of a "four-way handshake":

1. A "scout" frame sent from the board to the destination station. This includes a `controlByte`
   and `port` which are used by the receiver to identify the type of data being sent.
2. Assuming the receiver is (a) connected to the network and listening for traffic and (b)
   is configured to handle the `controlByte`/`port`, it responds with a "scout ack" frame
   instructing the caller to proceed.
3. The board sends a frame containing the payload `data` to the destination station.
4. The receiver responds with a "data ack" frame confirming receipt of the data.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `station` | `number` | Destination Econet station number (integer in range 1-254, inclusive). |
| `network` | `number` | Destination Econet network number (0 for local network; only use other values if you have an appropriately configured Econet bridge). |
| `controlByte` | `number` | Econet control byte (integer in range 0-255, inclusive). |
| `port` | `number` | Econet port number (integer in range 0-255, inclusive). |
| `data` | `Buffer` | Buffer containing binary payload data to send. |
| `extraScoutData?` | `Buffer` | Optional extra data to include in the scout frame. This is useful for a small number of special operations such as NOTIFY. |

#### Returns

`Promise`<[`TxResultEvent`](../classes/types_txResultEvent.TxResultEvent.md)\>

Describes the result of the operation. If the operation was successful then the
         `success` flag is set to `true`; otherwise the `description` field describes the
         error.

#### Defined in

[driver/index.ts:205](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L205)

___

### waitForEvent

▸ **waitForEvent**(`matcher`, `timeoutMs`): `Promise`<[`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)\>

Waits for a matching event with a timeout.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `matcher` | [`EventMatcher`](driver.md#eventmatcher) | A function that returns `true` if the passed event matches the required criteria. |
| `timeoutMs` | `number` | Maximum time to wait for a matching event in milliseconds. If no matching event is found within this period then the promise is rejected. |

#### Returns

`Promise`<[`EconetEvent`](../classes/types_econetEvent.EconetEvent.md)\>

The matching event.

#### Defined in

[driver/index.ts:305](https://github.com/jprayner/piconet/blob/81026b7/driver/nodejs/src/driver/index.ts#L305)
